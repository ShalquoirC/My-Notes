# 数据链路层

#### 信道类型

##### 1.点对点信道

##### 2.广播信道

#### 概念

**链路**，通信双方的物理电路端，中间没有任何交换节点

**数据链路**，装有实现一定协议和软件的链路

**帧**：点对点信道的数据链路层的协议数据单元

**IP数据报**：网络层协议数据单元（又称 **数据报** **分组** **包**）

## 一、点对点信道和广播信道和对应协议（PPP协议以及CSMA/CD协议）

## 二、数据链路层的三个基本问题：封装成帧、透明传输和差错检测

#### 1.封装成帧

​					在一段数据的前后分别添加首部和尾部（给帧确定界限）

​					首部和尾部重要作用**帧定界**。

​									**SOH**+**帧中的数据**+**EOT**

#### 2.透明传输

​								解决**SOH**+**帧中的数据**含EOT+**EOT**

##### 字节填充/字符填充：

对于数据中的SOH、EOT，在其前面加上转义字符ESC

------

#### <u>3.差错填充</u>   

作用：解决传输过程中产生的比特差错

误码率BER（Bit Error Rate)

##### **循环<u>冗余</u>检验CRC**

​		二进制模2运算，在位数为（k+n）的数据M除以实现选定好的长度为（n+1）位的**除数P**，得出**商是Q**，**余数R**。余数R比除数P少一位，【R是n位（添0）】

将余数R作为冗余码（*FCS*）拼接在数据M后发送出去。

###### CRC检验结果

1.R=0，帧正确，接受

2.R≠0，帧有差错（无法确定具体错误），丢弃。

###### 生成P(X)的方式：

P(X)=X^3+X^2+1     代表P=1101

##### 一般认为凡是接受端的数据链路层接受的帧均无差错

**CRC检验 不是可靠传输！！**

具体3-07、3-08

### 点对点协议PPP

满足上述三个基本要求

##### PPP协议的帧格式

首部4个字段；尾部2个字段

![1606741765986](C:\Users\MECHREVO\AppData\Roaming\Typora\typora-user-images\1606741765986.png)

##### 字节填充

​																					异步传输

​		当信心字段中出现和标志字段一样的比特组合时（0x7E）时必须采用。

###### 具体方法

* **0x7E 			——		转变			——		为2字节的序列 (0x7D,0x5E)**
* **0x7D        ——            转变      ——        为2字节的序列 (0x7D,0x5D)**
* ASCII码（一般不考）

##### 零比特填充

​																					同步传输

###### 具体方法

* 发送端，有**5个**连续 **1**，则立即填入一个 **0**
* 接收端。每发现 **5**个连续 **1** ，则将5个1之后的一个 **0** 删除

##### 不提供使用序号和确认的可靠传输

* 出错概率不大， 使用简单的PPP协议

##### PPP工作状态

LCP 下层 ：物理层

NCP 上层 ：网络层

## 网络适配器（网卡、NIC）

MAC子层：媒体接入控制MAC子层

#### 适配器的重要功能

* 进行串行/并行转换    （传输流要穿行）
* 对数据进行缓存         （缓存数据
* 在计算机的操作系统安装设备驱动程序
* 实现以太网协议

## CSMA/CD协议

为了通讯的便捷，以太网采取一下两种措施

#### 		1.采用较为灵活的无连接的工作方式

##### 				1）不必先建立链接就可以直接发送数据

##### 				2）以太网提供的服务是不可靠的交付（尽最大努力的交付）

​						不纠正差错，由高层决定纠错

#### 		2.以太网发送的数据都是用 曼彻斯特编码



### 	CSMA/CD协议要点（最短帧长64字节）

##### 			CSMA/CD含义：载波监听多点接入/碰撞检测

​			 		多点接入”表示许多计算机以**多点接入**的方式连接在**一根总线**上。

​					“载波监听”是指每一个站在发送数据之前**先要检测**一下总线上是否有其他计算机在发送				数据，如果有，则暂时不要发送数据，以免发生碰撞。

​					“碰撞检测”，计算机边发送数据边检测信道上的信号电压大小

局域网分析，单程端到端传播时延记为t，需要单程传播时延的2倍时间，才能检测到与其他的发送产生了冲突

​					使用CSMA/CD协议不能进行**全双工通信**只能进行**双向交替通信**（**半双工通信**

##### 			争用期 

​					以太网的端到端往返时延2t成为争用期，或碰撞窗口

​						具体征用时间51.2us

![](C:\Users\MECHREVO\AppData\Roaming\Typora\typora-user-images\1606820305973.png)

<u>**先听后发，边听边发，冲突停止，延迟重发**</u>

**最短帧长**见题3-20

集线器

## 以太网MAC层的硬件地址

#### MAC层的硬件地址

局域网中，硬件地址又称为物理地址，或MAC地址（48位的 地址，在本网络中不能重复）

适配器从网络上没收到一个MAC帧就首先用硬件检查MAC帧中的MAC地址。

* 如果是发往本站的帧则手下，然后再进行其他的处理
* 否则就将此帧丢弃，不再进行其他的处理。

发往本站的帧：

* 1.单播（一对一

* 2.广播（一对全体

* 3.多播（一对多

  ​																	以太网V2的MAC帧格式

![1606822001958](C:\Users\MECHREVO\AppData\Roaming\Typora\typora-user-images\1606822001958.png)

！前8字节 不是MAC帧 （用于同步）

18字节用于封装 

数据（64-18）46-1500字节

有效的MAC帧的长度为64-1518字

用收到的FCS查出有差错

#### 无效的MAC帧

* 数据字段的长度与

## 四、适配器、转发器、集线器、网桥、以太网交换机的作用以及使用场合

##### 集线器：

特点：

* 1.使用集线器的以太网在逻辑上仍是一个总线网，各站共享逻辑上的总线，实用的还是CSMA/CD。各站中的适配器执行CSMA/CD协议，各站必须竞争对传输媒体的控制，并且在同一时刻之多只允许一个站发送数据；

* 2.一个集线器有许多接口，从工作原理上来说，集线器很像一个**多接口的转发器；**

* 3.集线器工作在物理层，每个接口仅仅进行简单的比特转发，不进行碰撞检测。

*  4.集线器采用了专门的芯片，进行自适应串音回拨抵消。

##### 转发器

*  特点与集线器类似，只有两个接口。 

##### 网桥：

   特点：

* 网桥的每个端口与一个网段相连，网桥从端口接收网段上传送的各种帧。每当收到一个帧时，就先暂存在其缓冲中。若此帧未出现差错，且欲发往的目的站MAC地址属于另一网段，则通过查找站表，将收到的帧送往对应的端口转发出去。若该帧出现差错，则丢弃此帧。网桥过滤了通信量，扩大了物理范围，提高了可靠性，可互连不同物理层、不同MAC子层和不同速率的局域网。但同时也增加了时延，对用户太多和通信量太大的局域网不适合。

##### 以太网交换机：

实质上是一个多接口的网桥。

#### 区别：

##### 网桥与转发器不同：

（1）网桥工作在**数据链路层**，而转发器工作在**物理层**；

（2）**网桥**不像转发器转发所有的帧，而是只转发未出现差错，且目的站属于另一网络的帧或广播帧；

（3）**转发器**转发一帧时**不用检测传输媒体**，而**网桥**在转发一帧前**必须执行CSMA/CD算法**；

（4）**网桥**和**转发器**都有扩展局域网的作用，但**网桥**还能**提高局域网的效率**并**连接不同MAC子层和不同速率局域网的作用**。

以太网交换机通常有十几个端口，而网桥一般只有2-4个端口；

它们都工作在数据链路层；

网桥的端口一般连接到局域网，而以太网的每个接口都直接与主机相连，交换机允许多对计算机间能同时通信，而网桥允许每个网段上的计算机同时通信。

所以实质上以太网交换机是一个多端口的网桥，连到交换机上的每台计算机就像连到网桥的一个局域网段上。

网桥采用存储转发方式进行转发，而以太网交换机还可采用直通方式转发。

以太网交换机采用了专用的交换机构芯片，转发速度比网桥快。