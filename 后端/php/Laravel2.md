# Model例子这里举一个例子，我会做一个简单的功能，作为一个发表文章的网站的后端，然后使用`postman`做测试。考虑到这是一个简单的例子这次不会做任何的权限控制什么的。那么，首先开始构思，如果需要储存文章数据的话肯定需要数据库，要储存的是什么呢，是文章。一篇文章会有什么呢？标题，内容，发布时间大概就可以了？然后再加上一个唯一的id作为标识。完美| 属性名  | 类型        | 备注         || ------- | ----------- | ------------ || id      | big integer | 唯一的标识id || title   | string      | 标题         || content | text        | 内容         |唔，那么根据laravel的model一文，首先创建好数据库，这里我用`navicat`来进行数据库相关的操作。`navicat`可以百度搜索到，可以试用30天，百度也可以找到破解的教程。首先`.env`修改一下，确定好数据库的配置没错：```DB_CONNECTION=mysqlDB_HOST=127.0.0.1DB_PORT=3306DB_DATABASE=laravel_practiceDB_USERNAME=rootDB_PASSWORD=root```然后navicat创建一个到本地的而数据库连接，根据自己情况填主机端口用户名密码什么的。![image-20200202193703331](images/11.png)然后创建数据库，要和前面配置的一样。我配置的是`laravel_practice`，![image-20200202193924992](images/12.png)然后我们就不需要手动操作数据库了，其他的事情就全部交给laravel吧(x按照前面的规划，创建一个数据库迁移文件```phpphp artisan make:migration create_posts_table```然后在`up()`方法内应该这么写```Schema::create('posts', function (Blueprint $table) {    $table->bigIncrements('id');    $table->string('title');    $table->string('content');    $table->timestamps();});```写完之后保存，然后执行```php artisan migrate```然后laravel就会把规划好的数据表结构写入数据库。![image-20200202194756434](images/13.png)可以看到我们想要的结构![image-20200202201434812](images\14.png)然后数据库结构弄好了，我需要告诉laravel我有这样的一种数据叫post，就是我们需要创建一个Model类对应这一个表：```php artisan make:model Post```然后app目录下多了一个`Post.php`。到这里其实就定义好了。然后开始实现功能首先，让用户可以增加文章，新功能，从路由开始：```php//api.phpRoute::group(['prefix' => 'post', 'namespace' => 'Api'], function () {    Route::post('add', 'PostController@add');});```考虑到关于post的可能会有多个功能，分散开来不太美观，这里用到一个叫group的方法，可以把同一个大模块的路由放在一起，然后可以对这些路由统一管理，比如`prefix`就是规定这个路由组里面的路由路径会额外多一个prefix，比如简单的`Route::post('add', 'PostController@add');`对应的路径是`/api/add`，那么路由组定义了`post`的`prefix`的话，这个路由对应的路径就变成了`/api/post/add`然后在这个路由里面还定义了一个`namespace`意味着这个路由指向的控制器应该有一个额外的命名空间前缀，当没有的时候他会指向`\App\Http\Controllers\PostController`，当加了一个`Api`的`namespace`之后这个路由指向的就是`\App\Http\Controllers\Api\PostController`路由定义好了，然后定义一个控制器：```php artisan make:controller Api/PostController```默认代码：```php<?phpnamespace App\Http\Controllers\Api;use App\Http\Controllers\Controller;use Illuminate\Http\Request;class PostController extends Controller{    //}```我们给这个类加入一个方法，对应路由定义的`@add`：```phppublic function add(Request $request){    //获取传递的参数    $title = $request->title;    $content = $request->content;    //判断是不是传值有没有缺失，如果有返回错误    if(empty($title) || empty($content)) {        return response()->json([            'ret' => '1001',            'desc' => '缺少参数',            'data' => null        ]);    }    //创建一个Post的实例并且保存    $post = new Post;    $post->title = $title;    $post->content = $content;    $post->save();    //返回一个响应告诉客户端新建成功了    return response()->json([        'ret' => '200',        'desc' => '成功',        'data' => null    ]);}```然后我们还需要use一下之前告诉laravel的那个Model类，也就是Post。在头部加入`use App\Post;`然后这个文件就变成了：```php<?phpnamespace App\Http\Controllers\Api;use App\Http\Controllers\Controller;use Illuminate\Http\Request;use App\Post;class PostController extends Controller{    public function add(Request $request)    {        //获取传递的参数        $title = $request->title;        $content = $request->content;        //判断是不是传值有没有缺失，如果有返回错误        if(empty($title) || empty($content)) {            return response()->json([                'ret' => '1001',                'desc' => '缺少参数',                'data' => null            ]);        }        //创建一个Post的实例并且保存        $post = new Post;        $post->title = $title;        $post->content = $content;        $post->save();        //返回一个响应告诉客户端新建成功了        return response()->json([            'ret' => '200',            'desc' => '成功',            'data' => null        ]);    }}```然后我们就测试一下有没有成功吧：![image-20200202201221271](images/15.png)然后再看看数据库：![image-20200202201552872](images\16.png)可以看到数据库里已经有数据了，然后继续做查找，这里我们做一个简单的功能，直接返回所有的数据。加上一个路由，变成这样：```phpRoute::group(['prefix' => 'post', 'namespace' => 'Api'], function () {    Route::post('add', 'PostController@add');    Route::post('list', 'PostController@list');});```控制器内添加新的方法：```public function list(Request $request){    return response()->json([        'ret' => 200,        'desc' => '成功',        'data' => Post::get()    ]);}```这里再json里面直接输入了Post的集合，当json遇到这个东西的时候会调用其`toJson`方法将其转化为json格式。测试：![image-20200202202049962](images\17.png)然后继续写删除：路由：```phpRoute::group(['prefix' => 'post', 'namespace' => 'Api'], function () {    Route::post('add', 'PostController@add');    Route::post('list', 'PostController@list');    Route::post('delete', 'PostController@delete');});```方法：```public function delete(Request $request){    //从请求获取要删除的id    $id = $request->id;    //通过find静态方法传入实例的id尝试获取对应的实例    $post = Post::find($id);    //判断这个实例存不存在，不存在则直接返回错误    if(empty($post)){        return response()->json([            'ret' => '1002',            'desc' => '找不到该文章',            'data' => null        ]);    }    //调用delete方法删除实例    $post->delete();    //返回成功的响应    return response()->json([        'ret' => 200,        'desc' => '成功',        'data' => null    ]);}```测试一下：![image-20200202202434757](images\18.png)返回说删除成功了，然后我们看一下数据库：![image-20200202202522198](images\19.png)可以看到那一条数据没掉了。唔，然后。。忘记写修改了！路由：```phpRoute::group(['prefix' => 'post', 'namespace' => 'Api'], function () {    Route::post('add', 'PostController@add');    Route::post('list', 'PostController@list');    Route::post('delete', 'PostController@delete');    Route::post('modify', 'PostController@modify');});```方法：```phppublic function modify(Request $request){    //用请求获取数据    $id = $request->id;    $title = $request->title;    $content = $request->content;    //通过find静态方法传入实例的id尝试获取对应的实例    $post = Post::find($id);    //判断这个实例存不存在，不存在则直接返回错误    if(empty($post)){        return response()->json([            'ret' => '1002',            'desc' => '找不到该文章',            'data' => null        ]);    }    //判断用户有没有传入对应的数据，有的话就更新model实例的对应项。    if(!empty($title)){        $post->title = $title;    }    if(!empty($content)){        $post->content = $content;    }    //把更改应用进数据库    $post->save();    return response()->json([        'ret' => 200,        'desc' => '成功',        'data' => null    ]);}```因为之前的那条数据删掉了。。我就不测试了这个然后如果不是根据id来搜索实例的话，比如我要查找一个标题为"文章标题"的文章，我就要这么去获取实例：```phpPost::where('title','文章标题')->first();``` 大概就写到这里吧，所有的代码都已经push进仓库里面了